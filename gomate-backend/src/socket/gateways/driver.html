<!doctype html>
<html>
  <head>
    <title>Driver Test</title>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  </head>
  <body>
    <h1>Driver 1 Side</h1>
    <script>
      const socket = io('http://localhost:3000', {
        transports: ['websocket'],
      });

      const driverId = '68908c87f5bd1d56dcc631b8';

      socket.on('connect', () => {
        console.log('Driver connected:', socket.id);

        const driverData = {
          driverId,
          location: [31.576079, 74.42812],
          rideType: 'car',
        };

        console.log('Emitting driver data:', driverData);

        // Register driver with backend
        socket.emit('registerDriver', driverData);
      });

      // Listen for new ride requests
      socket.on('newRideRequest', (rideData) => {
        console.log('Driver received new ride request:', rideData);

        // ðŸ‘‰ no auto counter-offer here
        // console.log(
        //   'To send a counter offer manually, run this in console:\n',
        //   `socket.emit("sendCounterOffer", {
        //     driverId: "${driverId}",
        //     passengerId: "${rideData.passengerId}",
        //     rideId: "${rideData.rideId}",
        //     counterFare: 759
        //   });`,
        // );
      });

      // ðŸ‘‰ Listen for when passenger accepts this driverâ€™s offer
      socket.on('offerAccepted', (data) => {
        console.log('âœ… Your offer was accepted:', data);
      });

      // Listen for confirmation
      socket.on('rideStarted', (data) => {
        console.log('Ride started:', data.message);
        // Update driver UI to show ride is active
      });

      // Handle cancellation
      socket.on('rideCancelled', (data) => {
        console.log('Ride cancelled:', data.reason);
        // Update driver UI to show ride was cancelled
      });

      socket.on('disconnect', () => {
        console.log('Driver disconnected from server');
      });
    </script>
  </body>
</html>
